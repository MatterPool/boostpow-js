'use strict';
var expect = require('chai').expect;
var index = require('../dist/index.js');
var bsv = require ('bsv');
describe('boost #BoostSignal tests', () => {

   it('should failed to instantiate a signal with null', async () => {
      try {
         index.BoostSignal.fromHex(null);
      } catch (ex) {
         expect(ex.toString()).to.eq('Error: invalid argument');
         return;
      }
      expect(true).to.eql(false);
   });

   it('should instantiate a signal with only pow string', async () => {
      const pows = [
         { boostJobId: '0138e22adf9f1ad791e8502fdd5217cefad49cc9da21450ddadd104a1b1eb71e.0',
            boostPowString: '0000000033323339747365542074736f6f42206f6c6c6548000000000000000000000000946cb28060eeb84d58176310531b98f043b9c3c7aa9afb22b153431e9b247471f4cf825e80ff7f1ced58f240',
            boostPowMetadata: '000000000000000000000000000000000000000092e4d5ab4bb067f872d28f44d3e5433e56fca190460446750000000000000000000000000000000000000000000000000000000000000000000000000000000000000000' },
         { boostJobId: '6285945097411d3865098dd85d8d21a03a5daa4c85a171240d95032263a010ec.0',
            boostPowString: '0000000033323339747365542074736f6f42206f6c6c65480000000000000000000000001719080ea4eaa516315f887cde5188129f413e33ca0dd8dafd0c5848948d3bb500cc825effff001d08e93848',
            boostPowMetadata: '67617420796d000000000000000000000000000092e4d5ab4bb067f872d28f44d3e5433e56fca190460446750000000000000000000000007d323334203a6f6f66202c27676e697473657427203a65707974207b00000000' },
         { boostJobId: '8f4f8e407c654205ddb0dec5e5a52e7cf93f6e6c858d7bb5ab40c9f13674af6b.0',
            boostPowString: '5254544d33323339747365542074736f6f42206f6c6c6548000000000000000000000000946cb28060eeb84d58176310531b98f043b9c3c7aa9afb22b153431e9b2474710acb825effff001d2150359a',
            boostPowMetadata: '000000000000000000000000000000000000000092e4d5ab4bb067f872d28f44d3e5433e56fca190460446750000000000000000000000000000000000000000000000000000000000000000000000000000000000000000' }
      ];

      const signal = index.BoostSignal.fromHex(pows[0].boostPowString);
      expect(signal.toObject()).to.eql({
         boostJobId: undefined,
         boostJobProofId: undefined,
         boostPowString: '0000000033323339747365542074736f6f42206f6c6c6548000000000000000000000000946cb28060eeb84d58176310531b98f043b9c3c7aa9afb22b153431e9b247471f4cf825e80ff7f1ced58f240',
         boostPowMetadata: null
      });
   });

   it('should instantiate a signal with powstring and metadata in the first argument', async () => {
      const pows = [
         { boostJobId: '0138e22adf9f1ad791e8502fdd5217cefad49cc9da21450ddadd104a1b1eb71e.0',
            boostPowString: '0000000033323339747365542074736f6f42206f6c6c6548000000000000000000000000946cb28060eeb84d58176310531b98f043b9c3c7aa9afb22b153431e9b247471f4cf825e80ff7f1ced58f240',
            boostPowMetadata: '000000000000000000000000000000000000000092e4d5ab4bb067f872d28f44d3e5433e56fca190460446750000000000000000000000000000000000000000000000000000000000000000000000000000000000000000' },
         { boostJobId: '6285945097411d3865098dd85d8d21a03a5daa4c85a171240d95032263a010ec.0',
            boostPowString: '0000000033323339747365542074736f6f42206f6c6c65480000000000000000000000001719080ea4eaa516315f887cde5188129f413e33ca0dd8dafd0c5848948d3bb500cc825effff001d08e93848',
            boostPowMetadata: '67617420796d000000000000000000000000000092e4d5ab4bb067f872d28f44d3e5433e56fca190460446750000000000000000000000007d323334203a6f6f66202c27676e697473657427203a65707974207b00000000' },
         { boostJobId: '8f4f8e407c654205ddb0dec5e5a52e7cf93f6e6c858d7bb5ab40c9f13674af6b.0',
            boostPowString: '5254544d33323339747365542074736f6f42206f6c6c6548000000000000000000000000946cb28060eeb84d58176310531b98f043b9c3c7aa9afb22b153431e9b2474710acb825effff001d2150359a',
            boostPowMetadata: '000000000000000000000000000000000000000092e4d5ab4bb067f872d28f44d3e5433e56fca190460446750000000000000000000000000000000000000000000000000000000000000000000000000000000000000000' }
      ];

      const signal = index.BoostSignal.fromHex(pows[0].boostPowString + pows[0].boostPowMetadata);
      expect(signal.toObject()).to.eql({
         boostJobId: undefined,
         boostJobProofId: undefined,
         boostPowString: '0000000033323339747365542074736f6f42206f6c6c6548000000000000000000000000946cb28060eeb84d58176310531b98f043b9c3c7aa9afb22b153431e9b247471f4cf825e80ff7f1ced58f240',
         boostPowMetadata: '000000000000000000000000000000000000000092e4d5ab4bb067f872d28f44d3e5433e56fca190460446750000000000000000000000000000000000000000000000000000000000000000000000000000000000000000',
      });
   });
   it('should instantiate a signal with powstring and metadata in seperate arguments', async () => {
      const pows = [
         { boostJobId: '0138e22adf9f1ad791e8502fdd5217cefad49cc9da21450ddadd104a1b1eb71e.0',
            boostPowString: '0000000033323339747365542074736f6f42206f6c6c6548000000000000000000000000946cb28060eeb84d58176310531b98f043b9c3c7aa9afb22b153431e9b247471f4cf825e80ff7f1ced58f240',
            boostPowMetadata: '000000000000000000000000000000000000000092e4d5ab4bb067f872d28f44d3e5433e56fca190460446750000000000000000000000000000000000000000000000000000000000000000000000000000000000000000' },
         { boostJobId: '6285945097411d3865098dd85d8d21a03a5daa4c85a171240d95032263a010ec.0',
            boostPowString: '0000000033323339747365542074736f6f42206f6c6c65480000000000000000000000001719080ea4eaa516315f887cde5188129f413e33ca0dd8dafd0c5848948d3bb500cc825effff001d08e93848',
            boostPowMetadata: '67617420796d000000000000000000000000000092e4d5ab4bb067f872d28f44d3e5433e56fca190460446750000000000000000000000007d323334203a6f6f66202c27676e697473657427203a65707974207b00000000' },
         { boostJobId: '8f4f8e407c654205ddb0dec5e5a52e7cf93f6e6c858d7bb5ab40c9f13674af6b.0',
            boostPowString: '5254544d33323339747365542074736f6f42206f6c6c6548000000000000000000000000946cb28060eeb84d58176310531b98f043b9c3c7aa9afb22b153431e9b2474710acb825effff001d2150359a',
            boostPowMetadata: '000000000000000000000000000000000000000092e4d5ab4bb067f872d28f44d3e5433e56fca190460446750000000000000000000000000000000000000000000000000000000000000000000000000000000000000000' }
      ];

      const signal = index.BoostSignal.fromHex(pows[1].boostPowString, pows[1].boostPowMetadata);
      expect(signal.toObject()).to.eql({
         boostJobId: undefined,
         boostJobProofId: undefined,
         boostPowString: '0000000033323339747365542074736f6f42206f6c6c65480000000000000000000000001719080ea4eaa516315f887cde5188129f413e33ca0dd8dafd0c5848948d3bb500cc825effff001d08e93848',
         boostPowMetadata: '67617420796d000000000000000000000000000092e4d5ab4bb067f872d28f44d3e5433e56fca190460446750000000000000000000000007d323334203a6f6f66202c27676e697473657427203a65707974207b00000000',
      });

      expect(signal.category()).to.eql('\u0000\u0000\u0000\u0000');
      expect(signal.category(true)).to.eql('00000000');
      expect(signal.content()).to.eql('Hello Boost Test9323');
      expect(signal.content(true)).to.eql('00000000000000000000000048656c6c6f20426f6f7374205465737439333233');
      expect(signal.tag()).to.eql('\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000my tag');
      expect(signal.tag(true)).to.eql('00000000000000000000000000006d7920746167');
      expect(signal.additionalData()).to.eql("\u0000\u0000\u0000{ type: \'testing\', foo: 432}");
      expect(signal.additionalData(true)).to.eql('000000007b20747970653a202774657374696e67272c20666f6f3a203433327d00000000');
      expect(signal.userNonce()).to.eql('');
      expect(signal.userNonce(true)).to.eql('00000000');
      expect(signal.time()).to.eql(1585630208);
      expect(signal.difficulty()).to.eql(1);
      expect(signal.energy()).to.eql(1);
      expect(signal.getBoostPowString().toString()).to.eql('0000000033323339747365542074736f6f42206f6c6c65480000000000000000000000001719080ea4eaa516315f887cde5188129f413e33ca0dd8dafd0c5848948d3bb500cc825effff001d08e93848');
      expect(signal.getBoostMetadata().toString()).to.eql('00000000000000000000000000006d792074616792e4d5ab4bb067f872d28f44d3e5433e56fca190460446750000000000000000000000007b20747970653a202774657374696e67272c20666f6f3a203433327d00000000');
   });

   it('should instantiate a signal with powstring and metadata in seperate arguments', async () => {
      const pows = [
         { boostJobId: '0138e22adf9f1ad791e8502fdd5217cefad49cc9da21450ddadd104a1b1eb71e.0',
            boostPowString: '0000000033323339747365542074736f6f42206f6c6c6548000000000000000000000000946cb28060eeb84d58176310531b98f043b9c3c7aa9afb22b153431e9b247471f4cf825e80ff7f1ced58f240',
            boostPowMetadata: '000000000000000000000000000000000000000092e4d5ab4bb067f872d28f44d3e5433e56fca190460446750000000000000000000000000000000000000000000000000000000000000000000000000000000000000000' },
         { boostJobId: '6285945097411d3865098dd85d8d21a03a5daa4c85a171240d95032263a010ec.0',
            boostPowString: '0000000033323339747365542074736f6f42206f6c6c65480000000000000000000000001719080ea4eaa516315f887cde5188129f413e33ca0dd8dafd0c5848948d3bb500cc825effff001d08e93848',
            boostPowMetadata: '67617420796d000000000000000000000000000092e4d5ab4bb067f872d28f44d3e5433e56fca190460446750000000000000000000000007d323334203a6f6f66202c27676e697473657427203a65707974207b00000000' },
         { boostJobId: '8f4f8e407c654205ddb0dec5e5a52e7cf93f6e6c858d7bb5ab40c9f13674af6b.0',
            boostPowString: '5254544d33323339747365542074736f6f42206f6c6c6548000000000000000000000000946cb28060eeb84d58176310531b98f043b9c3c7aa9afb22b153431e9b2474710acb825effff001d2150359a',
            boostPowMetadata: '000000000000000000000000000000000000000092e4d5ab4bb067f872d28f44d3e5433e56fca190460446750000000000000000000000000000000000000000000000000000000000000000000000000000000000000000' }
      ];

      const signal = index.BoostSignal.fromHex(pows[1].boostPowString, pows[1].boostPowMetadata, '0138e22adf9f1ad791e8502fdd5217cefad49cc9da21450ddadd104a1b1eb71e');
      expect(signal.toObject()).to.eql({
         boostJobId: '0138e22adf9f1ad791e8502fdd5217cefad49cc9da21450ddadd104a1b1eb71e',
         boostJobProofId: undefined,
         boostPowString: '0000000033323339747365542074736f6f42206f6c6c65480000000000000000000000001719080ea4eaa516315f887cde5188129f413e33ca0dd8dafd0c5848948d3bb500cc825effff001d08e93848',
         boostPowMetadata: '67617420796d000000000000000000000000000092e4d5ab4bb067f872d28f44d3e5433e56fca190460446750000000000000000000000007d323334203a6f6f66202c27676e697473657427203a65707974207b00000000',
      });
      expect(signal.toString()).to.eql('0000000033323339747365542074736f6f42206f6c6c65480000000000000000000000001719080ea4eaa516315f887cde5188129f413e33ca0dd8dafd0c5848948d3bb500cc825effff001d08e9384867617420796d000000000000000000000000000092e4d5ab4bb067f872d28f44d3e5433e56fca190460446750000000000000000000000007d323334203a6f6f66202c27676e697473657427203a65707974207b00000000');

      expect(signal.getBoostJobId()).to.eql('0138e22adf9f1ad791e8502fdd5217cefad49cc9da21450ddadd104a1b1eb71e');
      expect(signal.getBoostJobProofId()).to.eql(undefined);
      expect(signal.category()).to.eql('\u0000\u0000\u0000\u0000');
      expect(signal.category(true)).to.eql('00000000');
      expect(signal.content()).to.eql('Hello Boost Test9323');
      expect(signal.content(true)).to.eql('00000000000000000000000048656c6c6f20426f6f7374205465737439333233');
      expect(signal.tag()).to.eql('\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000\u0000my tag');
      expect(signal.tag(true)).to.eql('00000000000000000000000000006d7920746167');
      expect(signal.additionalData()).to.eql("\u0000\u0000\u0000{ type: \'testing\', foo: 432}");
      expect(signal.additionalData(true)).to.eql('000000007b20747970653a202774657374696e67272c20666f6f3a203433327d00000000');
      expect(signal.userNonce()).to.eql('');
      expect(signal.userNonce(true)).to.eql('00000000');
      expect(signal.time()).to.eql(1585630208);
      expect(signal.difficulty()).to.eql(1);
      expect(signal.energy()).to.eql(1);
      expect(signal.getBoostPowString().toString()).to.eql('0000000033323339747365542074736f6f42206f6c6c65480000000000000000000000001719080ea4eaa516315f887cde5188129f413e33ca0dd8dafd0c5848948d3bb500cc825effff001d08e93848');
      expect(signal.getBoostMetadata().toString()).to.eql('00000000000000000000000000006d792074616792e4d5ab4bb067f872d28f44d3e5433e56fca190460446750000000000000000000000007b20747970653a202774657374696e67272c20666f6f3a203433327d00000000');
   });

});